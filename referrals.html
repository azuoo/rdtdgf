<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>صفحة الإحالات</title>
  <style>
    body {
      background-color: #100622;
      color: white;
      font-family: "Tajawal", sans-serif;
      text-align: center;
      padding: 2rem;
    }
    .card {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 14px;
      padding: 2rem;
      max-width: 400px;
      margin: 0 auto;
    }
    .code-box {
      background-color: #222;
      padding: 1rem;
      border-radius: 10px;
      word-break: break-all;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>رابط الدعوة الخاص بك:</h2>
    <div class="code-box" id="referralLink">جاري التحميل...</div>

    <h3 style="margin-top:2rem;">عدد المسجلين عن طريقك:</h3>
    <div class="code-box" id="referralCount">0</div>
  </div>

  <script>
    const userCode = localStorage.getItem('referralCode');
    const fullLink = https://https://azuoo.github.io/rdtdgf/.html?ref=${userCode};
    document.getElementById('referralLink').textContent = fullLink;

    // رابط Google Script
    const scriptURL = "https://script.google.com/macros/s/AKfycbx-OxGSvXjcd35seQ8Sz6zb_yEKXLPbujOgCi7CeZYR9IaQ56mqSqe9beVTWPj--D1PLg/exec";

    // قراءة البيانات من Google Sheets
    fetch(scriptURL)
      .then(res => res.json())
      .then(data => {
        const referred = data.filter(row => row.ReferredBy === userCode);
        document.getElementById('referralCount').textContent = referred.length;
      })
      .catch(err => {
        console.error(err);
        document.getElementById('referralCount').textContent = "خطأ في الاتصال";
      });
  </script>
</body>
</html>
