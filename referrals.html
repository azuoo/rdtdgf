<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>صفحة الإحالات</title>
  <style>
    body {
      background-color: #100622;
      color: white;
      font-family: "Tajawal", sans-serif;
      text-align: center;
      padding: 2rem;
    }
    .card {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 14px;
      padding: 2rem;
      max-width: 400px;
      margin: 0 auto;
    }
    .code-box {
      background-color: #222;
      padding: 1rem;
      border-radius: 10px;
      word-break: break-all;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>رابط الدعوة الخاص بك:</h2>
    <div class="code-box" id="referralLink">جاري التحميل...</div>

    <h3 style="margin-top:2rem;">عدد المسجلين عن طريقك:</h3>
    <div class="code-box" id="referralCount">0</div>
  </div>
<script>
  const userCode = localStorage.getItem('referralCode');
  const userEmail = localStorage.getItem('email');

  // عرض رابط الإحالة
  const fullLink = https://azuoo.github.io/rdtdgf/index.html?ref=${userCode};
  document.getElementById('referralLink').textContent = fullLink;

  // رابط Google Script
  const scriptURL = "https://script.google.com/macros/s/AKfycbxJQC3ZR2A4WoI9E0gHlakHg8YsqSVDfcVqchzgaOBVU7FCYfK9Vr3GP863HylHA5gk/exec";

  // جلب عدد الإحالات باستخدام البريد الإلكتروني
  fetch(`${scriptURL}?email=${encodeURIComponent(userEmail)}`)
    .then(res => res.json())
    .then(data => {
      if (data.referrals_count !== undefined) {
        document.getElementById('referralCount').textContent = data.referrals_count;
      } else {
        document.getElementById('referralCount').textContent = "لا يوجد بيانات";
      }
    })
    .catch(err => {
      console.error(err);
      document.getElementById('referralCount').textContent = "خطأ في الاتصال";
    });
</script>
  
</body>
</html>
